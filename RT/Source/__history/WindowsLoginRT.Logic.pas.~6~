unit WindowsLoginRT.Logic;

interface

type
  TLocalDBLogin = class
  private
  {Private Declarations}
  public
  {Public Declarations}
  function SearchLDAP(AUserName: string): string;


end;

implementation

uses
  ipwldap, System.SysUtils;


{ TLocalDBLogin }

function TLocalDBLogin.SearchLDAP(AUsername: string): string;
var
  Ldap: TipwLDAP;
begin
  Ldap := TipwLDAP.Create(nil);
  try
    Ldap.ServerName := 'cswdc';
    Ldap.DN := 'DC=CentroSoftware,DC=com';
    Ldap.Name := AUsername; // Metti qui il nome utente LDAP se necessario
    Ldap.Password := '';

    Ldap.Bind;

    // Imposta il filtro di ricerca per trovare l'utente
    Ldap.Search(Format('(sAMAccountName=%s)', [AUsername]));

    if Ldap.ResultCode = 0 then
    begin
      Result := 'Distinguished name: ' + Ldap.ResultDN
    end
    else
    begin
      raise Exception.Create('User Not Found!');
    end;
  finally
    Ldap.Free;
  end;
end;

end.
